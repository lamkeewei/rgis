"use strict";angular.module("rgisApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","lr.upload"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).factory("_",function(){return window._}).factory("d3",function(){return window.d3}),angular.module("rgisApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("rgisApp").controller("PluginInputCtrl",["$scope","$modal","$log","$http","_","d3",function(a,b,c,d){d.get("sample_output.json").then(function(b){a.data=b.data.graph}),a.updateMap=function(a){console.log(a)},a.openPlugin=function(a,d){var e=b.open({templateUrl:"views/"+a+".html",controller:d,keyboard:!0});e.result.then(function(){c.info("Reply received!")})}}]),angular.module("rgisApp").controller("KfunctionCtrl",["$scope","$modalInstance","upload",function(a,b,c){a.execute=function(){c({url:"/api/plugin/kfunction",data:{window:a.window,points:a.points}}).then(function(a){b.close(a)},function(a){b.close(a)})},a.cancel=function(){b.close("cancelled")}}]),angular.module("rgisApp").directive("fileInput",function(){return{templateUrl:"views/fileInput.html",restrict:"A",scope:{name:"@fileInput"},link:function(a,b){var c=angular.element(b.children().children()[0]),d=angular.element(b.children().children()[1]),e=angular.element(b.children().children()[2]);d.css("display","none"),e.bind("click",function(){d.click()}),d.bind("change",function(){var a=d.val().split("\\");a=a[a.length-1],c.val(a)})}}}),angular.module("rgisApp").directive("plotArea",["d3",function(a){return{restrict:"A",scope:{data:"=",callback:"&"},link:function(b,c){var d=parseFloat(a.select(c[0]).style("width")),e=.7,f={top:20,right:20,bottom:30,left:50},g=d-f.left-f.right,h=e*d-f.top-f.bottom,i=a.select(c[0]).append("svg").attr("width",g+f.left+f.right).attr("height",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")");b.render=function(j){d=parseFloat(a.select(c[0]).style("width")),g=d-f.left-f.right,h=e*d-f.top-f.bottom;var k=a.scale.linear().range([0,g]),l=a.scale.linear().range([h,0]),m=a.svg.axis().scale(k).orient("bottom"),n=a.svg.axis().scale(l).orient("left"),o=a.svg.line().x(function(a){return k(a.r)}).y(function(a){return l(a.obs)}),p=a.svg.line().x(function(a){return k(a.r)}).y(function(a){return l(a.hi)}),q=a.svg.line().x(function(a){return k(a.r)}).y(function(a){return l(a.lo)}),r=a.svg.area().x(function(a){return k(a.r)}).y0(function(a){return l(a.lo)}).y1(function(a){return l(a.hi)});a.select(c[0]).select("svg").remove(),i=a.select(c[0]).append("svg").attr("width",g+f.left+f.right).attr("height",h+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),k.domain(a.extent(j,function(a){return a.r})),l.domain(a.extent(j,function(a){return a.obs})),i.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(m),i.append("g").attr("class","y axis").call(n).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("L function"),i.append("path").datum(j).attr("class","area").attr("d",r),i.append("path").datum(j).attr("class","line bounds").attr("d",p),i.append("path").datum(j).attr("class","line bounds").attr("d",q),i.append("path").datum(j).attr("class","line").attr("d",o);var s=a.behavior.drag().on("drag",function(){var b=k.range(),c=a.event.x>b[0]?a.event.x:b[0];c=c>b[1]?b[1]:c,t.attr("x",c)}).on("dragend",function(){var c=a.select(this).attr("x"),d=k.invert(c);b.callback({val:d})}),t=i.append("rect").attr("height",h).attr("width",2).attr("class","cursor").attr("x",3).attr("y",0).call(s)},window.onresize=function(){b.$apply()},b.$watch(function(){return angular.element(window)[0].innerWidth},function(){b.data&&b.render(b.data)}),b.$watch("data",function(a){a&&b.render(a)},!0)}}}]);